---
title: GraphQLGen ä»‹ç»:æ ¹æ® Graphql schema è‡ªåŠ¨ç”Ÿæˆç±»å‹å®‰å…¨çš„ resolver
tags: [prisma1]
---

graphqlgen æ ¹æ® Graphql schema ç¿»è¯‘å‡º resolver çš„ç±»å‹å®šä¹‰æ–‡ä»¶å’Œè„šæ‰‹æ¶æ¨¡æ¿ã€‚

è¿™æ ·å°±å¯ä»¥æŠŠç¹ççš„å†™ resolver æ ·æ¿ä»£ç çš„å·¥ä½œè‡ªåŠ¨å®Œæˆäº†ã€‚

prisma çš„è‡ªåŠ¨åŒ–å› æ­¤ç”± 50%æå‡åˆ° 75%ï¼Œè€Œä¸”å› ä¸ºè‡ªåŠ¨åŒ–ï¼Œcoding èµ·æ¥æ›´åŠ å®‰å…¨æ–¹ä¾¿ã€‚

![graphqlgen](/prisma1/images/graphqlgen.jpg)

ç±»å‹å®‰å…¨ä¸ºå¼€å‘äººå‘˜å¸¦æ¥äº†å¾ˆå¤šå¥½å¤„ã€‚ æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ **ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥**å’Œ **è‡ªåŠ¨å®Œæˆ**ä½¿å¼€å‘äººå‘˜å¯¹ä»£ç å……æ»¡ä¿¡å¿ƒå¹¶æé«˜äº†å·¥ä½œæ•ˆç‡ã€‚

å¦‚æœæ²¡æœ‰ç±»å‹å®‰å…¨æ€§ï¼Œå¾ˆå®¹æ˜“å¼•å…¥å°é”™åˆ«å­—æˆ–ç±»ä¼¼å¯é¿å…çš„é”™è¯¯ï¼Œæœ€ç»ˆéœ€è¦èŠ±è´¹æ•°å°æ—¶çš„è°ƒè¯•æ—¶é—´ã€‚ å¦‚ä½•è¯æ˜ç±»å‹å®‰å…¨çš„æ½œåœ¨å¥½å¤„ï¼Ÿ

<!--truncate-->

## ä»¥ä¸‹ GraphQL server ä¸­æœ‰å¤šå°‘é”™è¯¯ï¼ŸğŸ‘€

çœ‹å›¾æ‰¾é”™ï¼š

![graphql](/prisma1/images/iy9Lj2b.png)

GraphQL resolver å®ç°ä¸­æœ‰**äº”ä¸ª**é”™è¯¯ï¼š

1. æ— æ³•æ­£ç¡®è®¿é—®`login` resolver çš„æŸ¥è¯¢å‚æ•°ã€‚ è®¿é—®å®ƒä»¬çš„æ­£ç¡®æ–¹æ³•æ˜¯é€šè¿‡`args.input`ï¼ˆä¾‹å¦‚`args.input.password`ï¼‰ï¼Œå› ä¸ºå®ƒä»¬åŒ…å«åœ¨è¾“å…¥å¯¹è±¡ä¸­ã€‚
2. `args.username`åœ¨`login` resolver ä¸­å†™å…¥å…¨å°å†™ï¼ŒåŒæ—¶åœ¨ schema ä¸­ä½¿ç”¨ camelcase è¡¨ç¤ºæ³•ç¼–å†™ã€‚
3. ç¼ºå°‘ Mutation ç±»å‹çš„æ³¨å†Œ resolverã€‚
4. ç¼ºå°‘ User ç±»å‹çš„ userName resolverã€‚ è¯·æ³¨æ„ï¼Œè“è‰²æ¡†ä¸­çš„ç¤ºä¾‹ç”¨æˆ·è¡¨ç¤ºç”±æˆ‘çš„ resolver è¿”å›çš„ç”¨æˆ·å¯¹è±¡çš„å½¢çŠ¶ã€‚ è¿™å°±æ˜¯ id å’Œ name resolver æœ‰æ•ˆä½† username æ²¡æœ‰çš„åŸå› ï¼ˆå› ä¸º casing ä¸åŒ¹é…ï¼‰ã€‚
5. profilePictureUrl resolver è¿åäº† schema ä¸­å®šä¹‰çš„é null çº¦æŸã€‚

ä½ èŠ±äº†å¤šå°‘æ—¶é—´å¯»æ‰¾è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠä½ å®é™…å‘ç°äº†å¤šå°‘é—®é¢˜ï¼Ÿ å¦‚æœ resolver å®Œå…¨æ˜¯**ç±»å‹å®‰å…¨**çš„ï¼Œé‚£ä¹ˆä½ ä¸éœ€è¦èŠ±è´¹ä¸€ç§’é’Ÿæ¥è¯†åˆ«è¿™äº›é—®é¢˜ï¼Œè€Œåªéœ€è®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¸ºä½ æ•è·å®ƒä»¬ã€‚

**æˆ‘ä»¬æ„å»ºäº†`graphqlgen`æ¥å¸®åŠ©ä½ ä½¿ resolver ç±»å‹å®‰å…¨ã€‚**

## GraphQL types, models, resolvers

åœ¨æ·±å…¥ç ”ç©¶æ„å»º GraphQL æœåŠ¡å™¨æ—¶å‡ºç°çš„ä¸€äº›å…¸å‹é—®é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç®€è¦å›é¡¾ä¸€äº›ç›¸å…³çš„æ¦‚å¿µï¼šGraphQL types, models, resolvers

![graphql](/prisma1/images/U25F2c0.png)

åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†`schema.graphql`ä¸­å®šä¹‰çš„ GraphQL typesã€‚

resolver åœ¨å³ä¾§çš„`resolvers.ts`å®ç°ã€‚ è¯·æ³¨æ„ï¼Œ`city` resolver çš„è¿”å›å€¼æ˜¯ City resolver çš„è¾“å…¥å‚æ•°ï¼ˆçˆ¶çº§ï¼‰ã€‚

æ¨¡å‹åœ¨`models.ts`ä¸­å®šä¹‰ï¼Œè¡¨ç¤ºé€šè¿‡ resolver é“¾ä¼ é€’çš„å¯¹è±¡ã€‚ å®ƒä»¬ç”±ä¸€ä¸ª resolver è¿”å›ï¼Œå¹¶å†æ¬¡ä½œä¸º resolver æ ‘ä¸­åç»­ resolver çš„`parent`å‚æ•°æ‰¾åˆ°ï¼ˆå‚è§è“è‰²æ ‡è®°çš„åŒºåŸŸï¼‰ã€‚

## æ„å»º GraphQL æœåŠ¡å™¨æ—¶çš„å…¸å‹é—®é¢˜

### resolver ä¸ GraphQL schema ä¹‹é—´çš„ä¸ä¸€è‡´

é—®é¢˜ï¼šä¿æŒ GraphQL schema å®šä¹‰ä¸ç›¸åº”çš„ resolver åŒæ­¥æ˜¯å¤æ‚çš„ä»»åŠ¡ï¼Œå¹¶ä¸”éšç€é¡¹ç›®çš„å¢é•¿è€Œå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚é—®é¢˜ä¸»è¦å‘ç”Ÿåœ¨å‘½åä¸ä¸€è‡´ï¼ˆä¾‹å¦‚æ‹¼å†™é”™è¯¯æˆ–é”™è¯¯ç¬¦å·ï¼‰ï¼Œæˆ–è€…ç›´æ¥å¿˜è®°å®ç°æ•´ä¸ª resolver åŠŸèƒ½ã€‚

è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨æ¨¡å¼ä¼˜å…ˆæ–¹æ³•å¼€å‘ GraphQL æœåŠ¡å™¨ã€‚è¿™æ„å‘³ç€ GraphQL schema å§‹ç»ˆæ˜¯çœŸå®çš„æ¥æºï¼Œå¹¶ä¸” resolver å®Œå…¨åŸºäº schema å®šä¹‰å®ç°ã€‚åœ¨ä½¿ç”¨æ¨¡å¼ä¼˜å…ˆæ—¶ï¼Œä½¿ç”¨ä» GraphQL schema å®šä¹‰æ´¾ç”Ÿ resolver æ¥å£çš„æ­£ç¡®å·¥å…·æ˜¯å…³é”®ã€‚

### æ¨¡å‹å’Œ resolver è¿”å›å€¼ä¹‹é—´çš„æ˜ å°„ä¸æ¸…æ¥š

é—®é¢˜ï¼šresolverï¼ˆåµŒå¥—ï¼‰GraphQL æŸ¥è¯¢çš„è¿‡ç¨‹æ¶‰åŠå¤šä¸ª resolverâ€œæ‰§è¡Œçº§åˆ«â€ï¼Œå…¶ä¸­å‰ä¸€ä¸ªæ‰§è¡Œçº§åˆ«çš„è¿”å›å€¼æ˜¯ä¸‹ä¸€ä¸ªæ‰§è¡Œçº§åˆ«çš„è¾“å…¥ã€‚ç¡®ä¿ resolver çš„è¿”å›å€¼ä¸`parent`å‚æ•°çš„é¢„æœŸç»“æ„åŒ¹é…æ˜¯è‡³å…³é‡è¦çš„ - å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™ GraphQL æœåŠ¡å™¨ä¼šåœ¨è¿è¡Œæ—¶çˆ†ç‚¸ã€‚

è§£å†³æ–¹æ¡ˆï¼šå¼•å…¥ç±»å‹å®‰å…¨æ¨¡å‹ï¼Œè¡¨ç¤º resolver çš„è¿”å›å€¼å’Œ`parent`å‚æ•°ã€‚ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œç¼–è¯‘å™¨å¯ç¡®ä¿å…ˆå‰æ‰§è¡Œçº§åˆ«çš„è¿”å›å€¼å§‹ç»ˆä¸ç›¸åº”`parent`å‚æ•°çš„æ‰€éœ€ç»“æ„åŒ¹é…ã€‚

### éœ€è¦å¤§é‡çš„æ ·æ¿ä»£ç 

é—®é¢˜ï¼šç¡®ä¿ä½ çš„ resolver å®Œå…¨æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œéœ€è¦å¤§é‡çš„æ ·æ¿ä»£ç ã€‚ä¿æŒè¯¥æ ·æ¿ä¸ GraphQL schema åŒæ­¥æ˜¯ä¸€ä¸ªéå¸¸éº»çƒ¦ä¸”å®¹æ˜“å‡ºé”™çš„è¿‡ç¨‹ã€‚åœ¨ä¸‹é¢äº†è§£ä½¿ resolver ç±»å‹å®‰å…¨æ‰€éœ€çš„æ ·æ¿æ–‡ä»¶ã€‚

æŸ¥çœ‹æ‰€éœ€çš„æ ·æ¿:

é”®å…¥ resolver å‚æ•°å¹¶ä¸”è¿”å›å€¼

GraphQL resolver é€šå¸¸ä¼šæ”¶åˆ°å››ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿™äº›å‚æ•°éƒ½éœ€è¦è¾“å…¥ï¼š

1. parentï¼šä¸Šä¸€å±‚ resolver æ‰§è¡Œçº§åˆ«çš„è¿”å›å€¼[äº†è§£æ›´å¤š](https://www.prisma.io/blog/graphqlgen-fj3s0ssc1jsx/-ac5e2950214e)
2. argsï¼šå®¢æˆ·ç«¯æäº¤çš„ GraphQL æŸ¥è¯¢å‚æ•°
3. contextï¼šé€šè¿‡ GraphQL resolver é“¾ä¼ é€’çš„å¯¹è±¡
4. infoï¼šæºå¸¦æŸ¥è¯¢çš„ AST[äº†è§£æ›´å¤š](https://www.prisma.io/blog/graphqlgen-fj3s0ssc1jsx/-6f26249f613a)

é»˜è®¤çš„ resolver å®ç°

ä½¿ç”¨çº¯ JavaScript æ„å»º GraphQL æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥çœç•¥é»˜è®¤çš„ resolver å®ç°ã€‚ ä½œä¸ºç¤ºä¾‹ï¼Œè¯·è€ƒè™‘æ­¤ GraphQL schemaï¼š

```graphql
type Query {
  users: [User!]!
}

type User {
  id: ID!
  name: String!
}
```

ä½¿ç”¨ TypeScript æ—¶ï¼Œä½ å¿…é¡»å®ç° id å’Œ name çš„ resolverï¼š

```graphql
const resolvers = {
  Query: {
    users: () => db.getUsers()
  },
  User: {
    id: parent => parent.id,
    name: parent => parent.name
  }
}
```

> ä½¿ç”¨çº¯ JavaScript æ—¶ï¼Œè¿™äº›é»˜è®¤çš„ resolver å®ç°å¯ä»¥çœç•¥ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”± graphql-js æ¨æ–­çš„ã€‚

è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥**è‡ªåŠ¨ç”Ÿæˆ**æ ·æ¿ã€‚é€šå¸¸ï¼Œæ‰€éœ€çš„æ ·æ¿ä»£ç æ˜¯åŸºäºä¸€äº›ç®€å•çš„è§„åˆ™ä» GraphQL schema æ´¾ç”Ÿçš„ã€‚ä¸ºäº†é¿å…åœ¨å°† GraphQL schema è½¬æ¢ä¸ºç›¸åº”çš„ç±»å‹å®šä¹‰æ—¶å‡ºç°äººä¸ºé”™è¯¯ï¼Œåº”è¯¥è‡ªåŠ¨æ‰§è¡Œæ­¤è¿‡ç¨‹ï¼Œå¹¶ä¸”åº”ä½¿ç”¨ä»£ç ç”Ÿæˆè‡ªåŠ¨ç”Ÿæˆæ ·æ¿ã€‚

## graphqlgen ä»‹ç» ğŸ‰

ä¸Šè¿°æ‰€æœ‰é—®é¢˜éƒ½å¯ä»¥é€šè¿‡é€‚å½“çš„å·¥ä½œæµç¨‹å’Œå·¥å…·æ¥è§£å†³ï¼ å®šä¹‰è¿™äº›å·¥ä½œæµç¨‹å¹¶æ„å»ºè¿™äº›å·¥å…·æ˜¯ Prisma çš„æ ¸å¿ƒç›®æ ‡ä¹‹ä¸€ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒ graphqlgenï¼Œä¸€ä¸ªå¸®åŠ©ä½ å®ç°ç±»å‹å®‰å…¨ resolver çš„å·¥å…·ã€‚ è¿™æ˜¯ä½ å¯ä»¥ç”¨å®ƒåšçš„ï¼š

- ç”Ÿæˆç±»å‹å®šä¹‰ä»£ç ï¼ˆç”¨äº resolver è¾“å…¥å‚æ•°å’Œè¿”å›å€¼ï¼‰å’Œé»˜è®¤çš„ä»¥ç¡®ä¿ç±»å‹å®‰å…¨çš„ resolver
- ç”±å¼€å‘äººå‘˜å®Œæˆçš„è„šæ‰‹æ¶ resolverâ€œéª¨æ¶â€

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… graphqlgenï¼š

```
cnpm install -g graphqlgen

```

> graphqlgen [docs](https://oss.prisma.io/graphqlgen/)

## Getting started

ä¸¤ç§æ–¹å¼å¼€å§‹ï¼š

1. æ·»åŠ  graphqlgen åˆ°å·²æœ‰é¡¹ç›®[here](https://github.com/prisma/graphqlgen#add-to-existing-project)
2. ä»é›¶å¼€å§‹ï¼ˆçœ‹ä¸‹é¢ï¼‰

> å¦‚æœè¦å°† graphqlgen æ·»åŠ åˆ°ç°æœ‰é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ graphqlgen --init å‘½ä»¤åˆ›å»º`graphqlgen.yml`çš„åˆå§‹ç‰ˆæœ¬ã€‚

### å»ºç«‹ fully-typed GraphQL server

å¼€å§‹ä½¿ç”¨ graphqlgen çš„æœ€å¿«æ–¹æ³•æ˜¯ä½¿ç”¨ npm init-initializer å»ºç«‹ fully-typed GraphQL serverï¼š

```
npm init graphqlgen ./my-graphql-server/
```

è¿™å°†åˆ›å»º my-graphql-server ç›®å½•ï¼Œå…¶ä¸­åŒ…å« GraphQL æœåŠ¡å™¨çš„ä»£ç ï¼ŒåŒ…æ‹¬ä½¿ç”¨ graphqlgen çš„è®¾ç½®ã€‚ graphqlgen CLI è¦æ±‚ä½ åœ¨é¡¹ç›®ä¸­æä¾› graphqlgen.yml é…ç½®æ–‡ä»¶ã€‚

### é…ç½® graphqlgen.yml

ç¤ºä¾‹ï¼š

```yaml

# ç”Ÿæˆä»£ç çš„è¯­è¨€

language: typescript

# ä½ çš„ GraphQL schema çš„è·¯å¾„

schema: ./src/schema.graphql

# Map SDL types from the GraphQL schema to TS models

models:
files: - ./src/types.ts

# ç”Ÿæˆ resolver çš„ç±»å‹å®šä¹‰å’Œé»˜è®¤ç”Ÿæˆçš„ resolver

# DO NOT EDIT THIS FILE ä¸è¦æ”¹è¿™ä¸ªæ–‡ä»¶

output: ./src/generated/graphqlgen.ts

# ä¸´æ—¶æ­å»ºçš„ resolver å¯ä»¥å¤åˆ¶å¹¶ç²˜è´´åˆ°ä½ çš„åº”ç”¨ç¨‹åºä¸­

resolver-scaffolding:
output: ./src/generated/tmp-resolvers/
layout: file-per-type

```

### ç”Ÿæˆä»£ç 

è¦è°ƒç”¨ä»£ç ç”Ÿæˆè¿‡ç¨‹ï¼Œè¯·è¿è¡Œ graphqlgen å‘½ä»¤ï¼š

![graphql](/prisma1/images/2KkOJN0.png)

è¿™å°†ä»`graphqlgen.yml`è¯»å–é…ç½®å¹¶å°†ç”Ÿæˆçš„ä»£ç å­˜å‚¨åœ¨ï¼š

- `./src/generated/graphqlgen.ts`ï¼šåŒ…å« resolver å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹çš„æ–‡ä»¶ã€‚ è¿˜åŒ…æ‹¬ resolver é»˜è®¤å®ç°ã€‚ æ­¤æ–‡ä»¶ä¸éœ€è¦æ‰‹åŠ¨ç¼–è¾‘ï¼Œéœ€è¦åœ¨æ¯æ¬¡æ›´æ”¹ GraphQL schema æ—¶é‡æ–°ç”Ÿæˆã€‚
- `./src/generated/tmp-resolvers/`ï¼šåŒ…å« resolverâ€œskeletonsâ€çš„ç›®å½•ã€‚ ç”Ÿæˆçš„æ–‡ä»¶æ˜¯ä¸´æ—¶çš„ã€‚ ç”Ÿæˆçš„æ–‡ä»¶ä¸­çš„ä»£ç å°†è¢«å¤åˆ¶å¹¶ç²˜è´´åˆ°ä½ å½“å‰çš„ GraphQL æœåŠ¡å™¨å®ç°ä¸­ã€‚
- è§ä¾‹å­[here](https://github.com/prisma/graphqlgen/tree/master/packages/graphqlgen-templates/yoga/src/generated/)

æ³¨æ„ï¼šgraphqlgen CLI ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘ä»¬æ¸¸æˆç©å®¶ä¹‹é—´çš„ gg å‘½ä»¤åˆ«åè°ƒç”¨ ğŸ¤“

## ä½¿ç”¨ graphqlgen çš„å¸¸ç”¨çš„å·¥ä½œæµç¨‹

graphqlgen å¯ä»¥åœ¨ä½ éœ€è¦ä¸º GraphQL schema å¼•å…¥æ›´æ”¹æ—¶ä¸ºä½ æä¾›å¸®åŠ©ï¼Œä¾‹å¦‚ï¼š

- å‘ GraphQL API æ·»åŠ æ–°æ“ä½œï¼ˆå³å‘ Queryï¼ŒMutation æˆ– Subscription ç±»å‹æ·»åŠ å­—æ®µï¼‰ã€‚
- æ›´æ–° GraphQL schema ä¸­çš„ç±»å‹ï¼Œä¾‹å¦‚ æ·»åŠ ï¼Œé‡å‘½åæˆ–åˆ é™¤ç±»å‹ä¸Šçš„å­—æ®µã€‚
- ä»æ¨¡å‹ä¸­åˆ é™¤å­—æ®µå¹¶æ›´æ–° resolverã€‚

è§‚çœ‹[æ­¤è§†é¢‘](https://youtu.be/6ZSF60zVFow)ï¼Œäº†è§£ graphqlgen çš„è¿è¡Œæƒ…å†µï¼ˆå‘ Ben Awad è‡´æ•¬ ğŸ™ï¼‰ï¼š

## graphqlgen ç‰¹æ€§

è™½ç„¶ graphqlgen å·²å‡†å¤‡å¥½æŠ•å…¥ç”Ÿäº§ï¼Œä½†å°šæœªè¾¾åˆ° 1.0ã€‚ é…ç½®æ–‡ä»¶`graphqlgen.yml`çš„ç»“æ„æ–¹å¼å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†ä¸»è¦åŠŸèƒ½å°†ä¿æŒä¸å˜ã€‚

graphlgen ç›®å‰æ”¯æŒ TypeScriptï¼Œä½†å¯¹ Flow å’Œ Reason çš„æ”¯æŒå·²ç»å¼€å§‹äº†ã€‚ æˆ‘ä»¬è¿˜è®¡åˆ’ä¸º graphlgen å¼•å…¥ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿï¼Œè¿™æ ·å°±å¯ä»¥ä¸å…¶ä»–å·¥å…·ï¼ˆå¦‚ Prisma æˆ– Apolloï¼‰è¿›è¡Œæ›´ç´§å¯†çš„é›†æˆã€‚

æˆ‘ä»¬å¾ˆé«˜å…´å¬åˆ°ä½ çš„æƒ³æ³•ï¼ éšæ„æä¾›æœ‰å…³ GitHub çš„åé¦ˆæˆ–åŠ å…¥æˆ‘ä»¬çš„å¾®ä¿¡ç¾¤è¿›è¡Œæ·±å…¥è®¨è®ºã€‚
