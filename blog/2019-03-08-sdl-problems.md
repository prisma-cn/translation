---
title: Schema firstÂ  å¼€å‘ Graphql æœåŠ¡å™¨çš„é—®é¢˜
tags: [prisma1, nexus]
---

> ç¿»è¯‘:[hanagm](https://github.com/hanagm) > [åŸæ–‡é“¾æ¥](https://www.prisma.io/blog/the-problems-of-schema-first-graphql-development-x1mn4cb0tyl3/)

GraphQL æœåŠ¡å™¨å¼€å‘çš„å·¥å…·åœ¨è¿‡å»ä¸¤å¹´ä¸­çˆ†ç‚¸å¼å¢é•¿ã€‚æˆ‘ä»¬è®¤ä¸ºå¯¹å¤§å¤šæ•°å·¥å…·çš„éœ€æ±‚æ¥è‡ªæµè¡Œçš„ Schema ä¼˜å…ˆæ–¹æ³• - å¹¶ä¸”å¯ä»¥é€šè¿‡æ›¿ä»£æ–¹æ¡ˆè§£å†³ï¼šä»£ç ä¼˜å…ˆã€‚

![img](prisma1/images/the-problems-of-schema-first-graphql-development.jpg)

<!--truncate-->

æœ¬æ–‡æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆçš„ç³»åˆ—æ–‡ç« çš„*ç¬¬ä¸€*éƒ¨åˆ†ï¼š

- ç¬¬ 1 éƒ¨åˆ†ï¼š**â€œSchema ä¼˜å…ˆâ€GraphQL æœåŠ¡å™¨å¼€å‘çš„é—®é¢˜**
- ç¬¬ 2 éƒ¨åˆ†ï¼š[ä»‹ç» GraphQL Nexusï¼šä»£ç ä¼˜å…ˆçš„ GraphQL æœåŠ¡å™¨å¼€å‘](/blog/2019/03/09/nexus)
- ç¬¬ 3 éƒ¨åˆ†ï¼š[å°† GraphQL Nexus ä¸æ•°æ®åº“ä¸€èµ·ä½¿ç”¨](/blog/2019/03/10/nexus-prisma)

**åœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ä»¬ï¼Œ**ä»¥ä¾¿åœ¨å³å°†å‘å¸ƒçš„æ–‡ç« æ—¶æ”¶åˆ°é€šçŸ¥ã€‚

---

## æ¦‚è¿°ï¼šä» Schema ä¼˜å…ˆåˆ°ä»£ç ä¼˜å…ˆ

æœ¬æ–‡æ¦‚è¿°äº† GraphQL æœåŠ¡å™¨å¼€å‘çš„å½“å‰çŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯æ‰€æ¶µç›–å†…å®¹çš„å¿«é€Ÿæ¦‚è¿°ï¼š

1. æœ¬æ–‡ä¸­â€œschema ä¼˜å…ˆâ€çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ
2. GraphQL æœåŠ¡å™¨å¼€å‘çš„æ¼”å˜
3. åˆ†æ SDL ä¼˜å…ˆå‘å±•çš„é—®é¢˜
4. ç»“è®ºï¼šSDL-first å¯èƒ½æœ‰ç”¨ï¼Œä½†éœ€è¦å¤§é‡å·¥å…·
5. ä»£ç ä¼˜å…ˆï¼šGraphQL æœåŠ¡å™¨å¼€å‘çš„ä¸€ç§è¯­è¨€æƒ¯ç”¨æ–¹å¼

è™½ç„¶æœ¬æ–‡ä¸»è¦æä¾› JavaScript ç”Ÿæ€ç³»ç»Ÿçš„ç¤ºä¾‹ï¼Œä½†å…¶ä¸­å¤§éƒ¨åˆ†ä¹Ÿé€‚ç”¨äºå…¶ä»–è¯­è¨€ç”Ÿæ€ç³»ç»Ÿä¸­çš„ GraphQL æœåŠ¡å™¨å¼€å‘ã€‚

---

### æœ¬æ–‡ä¸­â€œschema ä¼˜å…ˆâ€çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ

**schema ä¼˜å…ˆ**è¿™ä¸ªæœ¯è¯­éå¸¸æ¨¡ç³Šï¼Œæ€»çš„æ¥è¯´ä¼ è¾¾äº†ä¸€ä¸ªéå¸¸ç§¯æçš„æƒ³æ³•ï¼š**ä½¿ schema è®¾è®¡æˆä¸ºå¼€å‘è¿‡ç¨‹ä¸­çš„ä¼˜å…ˆäº‹é¡¹ã€‚**

åœ¨å®ç° schema ä¹‹å‰è€ƒè™‘æ¨¡å¼ï¼ˆä»¥åŠ APIï¼‰é€šå¸¸ä¼šäº§ç”Ÿæ›´å¥½çš„ API è®¾è®¡ã€‚å¦‚æœ schema è®¾è®¡ä¸å°½å¦‚äººæ„ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šé‡åˆ° API çš„é£é™©ï¼Œè¿™æ˜¯åç«¯å®ç°æ–¹å¼çš„ç»“æœï¼Œå¿½ç•¥äº†ä¸šåŠ¡é¢†åŸŸçš„åŸè¯­å’Œ API ä½¿ç”¨è€…çš„éœ€æ±‚ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¼€å‘è¿‡ç¨‹çš„ç¼ºç‚¹ï¼Œå…¶ä¸­ GraphQL æ¶æ„é¦–å…ˆåœ¨ SDL ä¸­*æ‰‹åŠ¨*å®šä¹‰ï¼Œä¹‹åå®ç°è§£æå™¨ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œ[SDL](https://www.prisma.io/blog/graphql-sdl-schema-definition-language-6755bcb9ce51)æ˜¯ API _çš„çœŸå®æ¥æº_ã€‚**ä¸ºäº†é˜æ˜ schema ä¼˜å…ˆè®¾è®¡ä¸è¿™ç§ç‰¹å®šå®ç°æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å°†ä»æ­¤å¤„é¦–å…ˆå°†å…¶ç§°ä¸º SDLã€‚**

ç›¸æ¯”ä¹‹ä¸‹ï¼Œ**ä»£ç ä¼˜å…ˆ**ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸º*è§£æå™¨ä¼˜å…ˆ*ï¼‰æ˜¯ä¸€ä¸ªä»¥*ç¼–ç¨‹*æ–¹å¼å®ç° GraphQL æ¶æ„çš„è¿‡ç¨‹ï¼Œè€Œæ¶æ„çš„ SDL ç‰ˆæœ¬æ˜¯*ç”Ÿæˆçš„å·¥ä»¶*ã€‚ä½¿ç”¨ä»£ç ä¼˜å…ˆï¼Œæ‚¨ä»ç„¶å¯ä»¥éå¸¸æ³¨æ„å‰æœŸ schema è®¾è®¡ï¼

---

### GraphQL æœåŠ¡å™¨å¼€å‘çš„æ¼”å˜

![img](prisma1/images/jFszNXY.png)

#### é˜¶æ®µ 1ï¼šæ—©æœŸä¸ `graphql-js`

å½“ GraphQL äº 2015 å¹´å‘å¸ƒæ—¶ï¼Œå·¥å…·ç”Ÿæ€ç³»ç»Ÿå¾ˆå°‘ã€‚åœ¨ JavaScript ä¸­åªæœ‰å®˜æ–¹[è§„èŒƒ](https://facebook.github.io/graphql/)åŠå…¶å‚è€ƒå®ç°ï¼š[`graphql-js`](https://github.com/graphql/graphql-js)ã€‚ç›´åˆ°ä»Šå¤©ï¼Œ`graphql-js`ä¹Ÿæ˜¯ç”¨äºæœ€æµè¡Œçš„ GraphQL æœåŠ¡å™¨ï¼Œå¦‚`apollo-server`ï¼Œ`express-graphql`å’Œ`graphql-yoga`ã€‚

ä½¿ç”¨`graphql-js`æ„å»º GraphQL æœåŠ¡å™¨æ—¶ï¼Œ[GraphQL æ¶æ„](https://www.prisma.io/blog/graphql-server-basics-the-schema-ac5e2950214e/)è¢«å®šä¹‰ä¸ºçº¯ JavaScript å¯¹è±¡ï¼š

**_Hello Wrold_**

```javascript
const { GraphQLSchema, GraphQLObjectType, GraphQLString } = require('graphql');

const schema = new GraphQLSchema({
  query: new GraphQLObjectType({
    name: 'Query',
    fields: {
      hello: {
        type: GraphQLString,
        args: {
          name: { type: GraphQLString },
        },
        resolve: (_, args) => `Hello ${args.name || 'World!'}`,
      },
    },
  }),
});
```

**_User Example_**

```javascript
const { GraphQLSchema, GraphQLObjectType, GraphQLString, GraphQLID } = require('graphql');

const UserType = new GraphQLObjectType({
  name: 'User',
  fields: {
    id: { type: GraphQLID },
    name: { type: GraphQLString },
  },
});

const schema = new GraphQLSchema({
  query: new GraphQLObjectType({
    name: 'Query',
    fields: {
      user: {
        type: UserType,
        args: {
          id: { type: GraphQLID },
        },
        resolve: (_, { id }) => {
          return fetchUserById(id); // fetch the user, e.g. from a database
        },
      },
    },
  }),
  mutation: new GraphQLObjectType({
    name: 'Mutation',
    fields: {
      createUser: {
        type: UserType,
        args: {
          name: { type: GraphQLString },
        },
        resolve: (_, { name }) => {
          return createUser(name); // create a user, e.g. in a database
        },
      },
    },
  }),
});
```

ä»è¿™äº›ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œç”¨äºåˆ›å»º GraphQL æ¨¡å¼çš„ API `graphql-js`éå¸¸è¯¦ç»†ã€‚æ¨¡å¼çš„ SDL è¡¨ç¤ºæ›´ç®€æ´ï¼Œæ›´å®¹æ˜“æŒæ¡ï¼š

**_Hello World (SDL)_**

```graphql
type Query {
  hello(name: String): String
}
```

**_User Example (SDL)_**

```graphql
type User {
  id: ID
  name: String
}
type Query {
  user(id: ID): User
}
type Mutation {
  createUser(name: String): User
}
```

> è¯¦ç»†äº†è§£å¦‚ä½•æ„å»º GraphQL æ¨¡å¼ä¸`graphql-js`åœ¨[æ­¤](https://www.prisma.io/blog/graphql-server-basics-the-schema-ac5e2950214e/)æ–‡ç« ã€‚

#### é˜¶æ®µ 2ï¼šSchema ä¼˜å…ˆæ¨å¹¿ `graphql-tools`

ä¸ºäº†ç®€åŒ–å¼€å‘å¹¶æé«˜å¯¹å®é™… API å®šä¹‰çš„å¯è§æ€§ï¼ŒApollo [`graphql-tools`](https://github.com/apollographql/graphql-tools)äº 2016 å¹´ 3 æœˆå¼€å§‹æ„å»ºåº“ï¼ˆ[è¿™](https://github.com/apollographql/graphql-tools/commit/fe17783a6a166278195d172beb5670b045fb300d)æ˜¯ç¬¬ä¸€æ¬¡æäº¤ï¼‰ã€‚

ç›®æ ‡æ˜¯å°†æ¨¡å¼*å®šä¹‰*ä¸å®é™…*å®ç°*åˆ†å¼€ï¼Œè¿™å¯¼è‡´äº†å½“å‰æµè¡Œçš„*æ¨¡å¼é©±åŠ¨*æˆ–*æ¨¡å¼ä¼˜å…ˆ* / *SDL ä¼˜å…ˆ*å¼€å‘è¿‡ç¨‹ï¼š

1. åœ¨ GraphQL SDL ä¸­æ‰‹åŠ¨ç¼–å†™ GraphQL æ¶æ„å®šä¹‰
2. å®ç°æ‰€éœ€çš„è§£æå™¨åŠŸèƒ½

é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œä¸Šé¢çš„ç¤ºä¾‹ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·

**_Hello World_**

```javascript
const { makeExecutableSchema } = require('graphql-tools');

const typeDefs = `
type Query {
  hello(name: String): String
}
`;

const resolvers = {
  Query: {
    hello: (_, args) => `Hello ${args.name || 'World!'}`,
  },
};

const schema = makeExecutableSchema({
  typeDefs,
  resolvers,
});
```

**_User Example_**

```javascript
const { makeExecutableSchema } = require('graphql-tools');

const typeDefs = `
type User {
  id: ID
  name: String
}
type Query {
  user(id: ID): User
}
type Mutation {
  createUser(name: String): User
}
`;

const resolvers = {
  Query: {
    user: (_, args) => fetchUserById(args.id), // fetch the user, e.g. from a database
  },
  Mutation: {
    createUser: (_, args) => createUser(args.name), // create a user, e.g. in a database
  },
};

const schema = makeExecutableSchema({
  typeDefs,
  resolvers,
});
```

è¿™äº›ä»£ç ç‰‡æ®µä¸ä¸Šé¢ä½¿ç”¨çš„ä»£ç å®Œå…¨ç­‰æ•ˆ`graphql-js`ï¼Œé™¤äº†å®ƒä»¬æ›´æ˜“è¯»å’Œæ›´å®¹æ˜“ç†è§£ã€‚

å¯è¯»æ€§ä¸æ˜¯ SDL ä¼˜å…ˆçš„å”¯ä¸€ä¼˜åŠ¿ï¼š

- è¿™ç§æ–¹æ³•**æ˜“äºç†è§£**ï¼Œ**éå¸¸é€‚åˆå¿«é€Ÿæ„å»º**
- ç”±äºæ¯ä¸ªæ–°çš„ API æ“ä½œé¦–å…ˆéœ€è¦åœ¨æ¨¡å¼å®šä¹‰ä¸­ä½“ç°å‡ºæ¥ï¼Œå› æ­¤**GraphQL æ¨¡å¼è®¾è®¡æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„**
- æ¶æ„å®šä¹‰å¯ä»¥ç”¨ä½œ**API æ–‡æ¡£**
- æ¨¡å¼å®šä¹‰å¯ä»¥ä½œä¸º**å‰ç«¯å’Œåç«¯å›¢é˜Ÿä¹‹é—´**çš„**é€šä¿¡å·¥å…·** - å‰ç«¯å¼€å‘äººå‘˜è·å¾—æˆæƒå¹¶æ›´å¤šåœ°å‚ä¸ API è®¾è®¡
- æ¨¡å¼å®šä¹‰å¯ä»¥**å¿«é€Ÿ**æ¨¡æ‹Ÿ**API**

#### é˜¶æ®µ 3ï¼šå¼€å‘æ–°å·¥å…·ä»¥â€œä¿®å¤â€SDL

è™½ç„¶ SDL-first å…·æœ‰è®¸å¤šä¼˜åŠ¿ï¼Œä½†è¿‡å»ä¸¤å¹´è¡¨æ˜å°†å…¶æ‰©å±•åˆ°æ›´å¤§çš„é¡¹ç›®æ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚åœ¨æ›´å¤æ‚çš„ç¯å¢ƒä¸­ä¼šå‡ºç°è®¸å¤šé—®é¢˜ï¼ˆæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è¯¦ç»†è®¨è®ºè¿™äº›é—®é¢˜ï¼‰ã€‚

è¿™äº›é—®é¢˜æœ¬èº«ç¡®å®æ˜¯å¯ä»¥è§£å†³çš„ - *å®é™…*é—®é¢˜æ˜¯è§£å†³è¿™äº›é—®é¢˜éœ€è¦ä½¿ç”¨ï¼ˆå¹¶å­¦ä¹ ï¼‰è®¸å¤šå…¶ä»–å·¥å…·ã€‚åœ¨è¿‡å»çš„ä¸¤å¹´ä¸­ï¼Œå·²ç»å‘å¸ƒäº†å¤§é‡çš„å·¥å…·ï¼Œè¿™äº›å·¥å…·æ­£åœ¨å°è¯•æ”¹è¿›å›´ç»• SDL ç¬¬ä¸€æ¬¡å¼€å‘çš„å·¥ä½œæµç¨‹ï¼šä»ç¼–è¾‘å™¨æ’ä»¶åˆ° CLIï¼Œå†åˆ°è¯­è¨€åº“ã€‚

å­¦ä¹ ï¼Œç®¡ç†å’Œé›†æˆæ‰€æœ‰è¿™äº›å·¥å…·çš„å¼€é”€å‡æ…¢äº†å¼€å‘äººå‘˜çš„é€Ÿåº¦ï¼Œå¹¶ä¸”å¾ˆéš¾è·Ÿä¸Š GraphQL ç”Ÿæ€ç³»ç»Ÿçš„æ­¥ä¼ã€‚

---

### åˆ†æ SDL ä¼˜å…ˆå‘å±•çš„é—®é¢˜

ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨ SDL-first å¼€å‘çš„é—®é¢˜é¢†åŸŸã€‚è¯·æ³¨æ„ï¼Œå¤§å¤šæ•°è¿™äº›é—®é¢˜ç‰¹åˆ«é€‚ç”¨äºå½“å‰çš„ JavaScript ç”Ÿæ€ç³»ç»Ÿã€‚

#### é—®é¢˜ 1ï¼šæ¨¡å¼å®šä¹‰å’Œè§£æå™¨ resolver ä¹‹é—´çš„ä¸ä¸€è‡´

ä½¿ç”¨ SDL ä¼˜å…ˆï¼Œæ¨¡å¼å®šä¹‰*å¿…é¡»*ä¸è§£æå™¨å®ç°çš„ç¡®åˆ‡ç»“æ„ç›¸åŒ¹é…ã€‚è¿™æ„å‘³ç€å¼€å‘äººå‘˜éœ€è¦ç¡®ä¿æ¨¡å¼å®šä¹‰å§‹ç»ˆä¸è§£æå™¨åŒæ­¥ï¼

è™½ç„¶è¿™å¯¹äºå°å‹æ¨¡å¼æ¥è¯´å·²ç»æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œä½†æ˜¯éšç€æ¨¡å¼å¢é•¿åˆ°æ•°ç™¾æˆ–æ•°åƒè¡Œï¼Œå®é™…ä¸Šå˜å¾—ä¸å¯èƒ½ï¼ˆä½œä¸ºå‚è€ƒï¼Œ[GitHub GraphQL schema](https://gist.github.com/nikolasburk/15f30bb3e19e5bf8329ff52787fa72b5)æœ‰è¶…è¿‡ 10k è¡Œï¼‰ã€‚

**å·¥å…·/è§£å†³æ–¹æ¡ˆï¼š**æœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©ä¿æŒæ¨¡å¼å®šä¹‰å’Œè§£æå™¨åŒæ­¥ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨åƒ[`graphqlgen`](https://github.com/prisma/graphqlgen)æˆ–ç­‰åº“æ¥ç”Ÿæˆä»£ç [`graphql-code-generator`](https://github.com/dotansimha/graphql-code-generator)ã€‚

> ä¸è¦ä»¥ä¸ºè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Ÿä»`graphqlgen` [æ–‡ç« ä¸­](/blog/2018/11/02/graphqlgen)è·å–æˆ‘ä»¬çš„æµ‹éªŒã€‚

#### é—®é¢˜ 2ï¼šGraphQL æ¨¡å¼çš„æ¨¡å—åŒ–

ç¼–å†™å¤§å‹ GraphQL æ¨¡å¼æ—¶ï¼Œé€šå¸¸ä¸å¸Œæœ›æ‰€æœ‰ GraphQL ç±»å‹å®šä¹‰éƒ½é©»ç•™åœ¨åŒä¸€æ–‡ä»¶ä¸­ã€‚ç›¸åï¼Œæ‚¨å¸Œæœ›å°†å®ƒä»¬åˆ†æˆæ›´å°çš„éƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œæ ¹æ®*åŠŸèƒ½*æˆ–*äº§å“*ï¼‰ã€‚

![image-20190308140805155](/static/assets/image-20190308140805155.jpg)

**å·¥å…·/è§£å†³æ–¹æ¡ˆï¼š**åƒ[`graphql-import`](https://github.com/prisma/graphql-import)æˆ–æœ€è¿‘çš„[`graphql-modules`](https://graphql-modules.com/)è¿™æ ·çš„å·¥å…·å¯ä»¥å¸®åŠ©è§£å†³ã€‚`graphql-import`ä½¿ç”¨è‡ªå®šä¹‰å¯¼å…¥è¯­æ³•ç¼–å†™ä¸º SDL æ³¨é‡Šã€‚`graphql-modules`æ˜¯ä¸€ä¸ªå·¥å…·é›†ï¼Œå¯ä»¥å¸®åŠ©è§£å†³*æ¨¡å¼åˆ†ç¦»*ï¼Œ*è§£æç¨‹åºç»„åˆ*ä»¥åŠ GraphQL æœåŠ¡å™¨çš„*å¯ä¼¸ç¼©ç»“æ„*çš„å®ç°ã€‚

#### é—®é¢˜ 3ï¼šæ¨¡å¼å®šä¹‰ä¸­çš„å†—ä½™ï¼ˆä»£ç é‡ç”¨ï¼‰

å¦ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•*é‡ç”¨* SDL å®šä¹‰ã€‚æ­¤é—®é¢˜çš„ä¸€ä¸ªå¸¸è§ç¤ºä¾‹æ˜¯ä¸­ç»§å¼è¿æ¥ã€‚è™½ç„¶æä¾›äº†ä¸€ç§å®ç°åˆ†é¡µçš„å¼ºå¤§æ–¹æ³•ï¼Œä½†å®ƒä»¬éœ€è¦*å¤§é‡*çš„æ ·æ¿å’Œé‡å¤çš„ä»£ç ã€‚

ç›®å‰æ²¡æœ‰å·¥å…·å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¼€å‘äººå‘˜å¯ä»¥ç¼–å†™è‡ªå®šä¹‰å·¥å…·æ¥å‡å°‘é‡å¤ä»£ç çš„éœ€è¦ï¼Œä½†æ­¤é—®é¢˜ç›®å‰ç¼ºä¹é€šç”¨è§£å†³æ–¹æ¡ˆã€‚

#### é—®é¢˜ 4ï¼šIDE æ”¯æŒå’Œå¼€å‘äººå‘˜ä½“éªŒ

GraphQL æ¶æ„åŸºäºå¼ºç±»å‹ç³»ç»Ÿï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥å¸¦æ¥å·¨å¤§çš„å¥½å¤„ï¼Œå› ä¸ºå®ƒå…è®¸å¯¹ä»£ç è¿›è¡Œé™æ€åˆ†æã€‚é—æ†¾çš„æ˜¯ï¼ŒSDL é€šå¸¸åœ¨ç¨‹åºä¸­è¡¨ç¤ºä¸ºçº¯*å­—ç¬¦ä¸²*ï¼Œè¿™æ„å‘³ç€å·¥å…·æ— æ³•è¯†åˆ«å…¶ä¸­çš„ä»»ä½•ç»“æ„ã€‚

æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯å¦‚ä½•åœ¨ç¼–è¾‘å™¨å·¥ä½œæµä¸­åˆ©ç”¨ GraphQL ç±»å‹ï¼Œä»¥ä¾¿ä» SDL ä»£ç çš„è‡ªåŠ¨å®Œæˆå’Œæ„å»ºæ—¶é”™è¯¯æ£€æŸ¥ç­‰åŠŸèƒ½ä¸­å—ç›Šã€‚

**å·¥å…·/è§£å†³æ–¹æ¡ˆï¼š**è¯¥[`graphql-tag`](https://github.com/apollographql/graphql-tag)åº“æš´éœ²`gql`ï¼Œæœ‰å°†ä¸€ä¸ª GraphQL å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ª AST çš„åŠŸèƒ½ï¼Œå› æ­¤èƒ½å¤Ÿé™æ€åˆ†æå’Œæ›´å¤šç‰¹ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å„ç§ç¼–è¾‘å™¨æ’ä»¶ï¼Œä¾‹å¦‚ç”¨äº VS Code çš„[GraphQL](https://marketplace.visualstudio.com/items?itemName=Prisma.vscode-graphql)æˆ–[Apollo GraphQL](https://marketplace.visualstudio.com/items?itemName=apollographql.vscode-apollo)æ’ä»¶ã€‚

#### é—®é¢˜ 5ï¼šç¼–å†™ GraphQL æ¨¡å¼

æ¨¡å—åŒ–æ¶æ„çš„æƒ³æ³•ä¹Ÿå¼•å‡ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•*é›†åˆ*è®¸å¤šç°æœ‰çš„ï¼ˆåˆ†å¸ƒå¼ï¼‰æ¶æ„æˆä¸€ä¸ªæ¨¡å¼ã€‚

**å·¥å…·/è§£å†³æ–¹æ¡ˆï¼š**æœ€å¸¸ç”¨çš„æ¨¡å¼ç»„åˆæ–¹æ³•æ˜¯[æ¨¡å¼æ‹¼æ¥](https://www.apollographql.com/docs/graphql-tools/schema-stitching.html)ï¼Œå®ƒä¹Ÿæ˜¯ä¸Šè¿°`graphql-tools`åº“çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†æ›´å¥½åœ°æ§åˆ¶æ¨¡å¼çš„ç»„æˆæ–¹å¼ï¼Œæ‚¨è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨[æ¨¡å¼å§”æ´¾](https://www.prisma.io/blog/graphql-schema-stitching-explained-schema-delegation-4c6caf468405)ï¼ˆå®ƒæ˜¯æ¨¡å¼æ‹¼æ¥çš„*å­é›†*ï¼‰ã€‚

### ç»“è®ºï¼šSDL-first å¯èƒ½*æœ‰ç”¨*ï¼Œä½†éœ€è¦å¤§é‡å·¥å…·

åœ¨æ¢ç´¢äº†è§£å†³å®ƒä»¬çš„é—®é¢˜é¢†åŸŸå’Œå„ç§å·¥å…·ä¹‹åï¼Œä¼¼ä¹ SDL ç¬¬ä¸€æ¬¡å¼€å‘æœ€ç»ˆ*å¯ä»¥*å‘æŒ¥ä½œç”¨ - è€Œä¸”å®ƒè¿˜è¦æ±‚å¼€å‘äººå‘˜å­¦ä¹ å’Œä½¿ç”¨å¤§é‡å…¶ä»–å·¥å…·ã€‚

![image-20190308141238294](/static/assets/image-20190308141238294.jpg)

#### è§£å†³æ–¹æ³•ï¼Œè§£å†³æ–¹æ³•ï¼Œè§£å†³æ–¹æ³•.....ï¼š

åœ¨ Prismaï¼Œæˆ‘ä»¬åœ¨æ¨åŠ¨ GraphQL ç”Ÿæ€ç³»ç»Ÿå‘å±•æ–¹é¢å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚è®¸å¤šæåˆ°çš„å·¥å…·éƒ½æ˜¯ç”±æˆ‘ä»¬çš„å·¥ç¨‹å¸ˆå’Œç¤¾åŒºæˆå‘˜æ„å»ºçš„ã€‚

![img](prisma1/images/OLITh8y.png)

ç»è¿‡å‡ ä¸ªæœˆçš„å¼€å‘å’Œä¸ GraphQL ç¤¾åŒºçš„å¯†åˆ‡äº’åŠ¨ï¼Œæˆ‘ä»¬é€æ¸æ„è¯†åˆ°æˆ‘ä»¬åªæ˜¯åœ¨ä¿®å¤ç—‡çŠ¶ã€‚è¿™å°±åƒæ”»æ‰“[ä¹å¤´è›‡ Boss](https://en.wikipedia.org/wiki/Lernaean_Hydra) - è§£å†³ä¸€ä¸ªé—®é¢˜å¯¼è‡´ä¸€äº›æ–°çš„é—®é¢˜ã€‚

#### ç”Ÿæ€ç³»ç»Ÿç»‘å®šï¼šæ•´ä¸ªå·¥å…·é“¾

æˆ‘ä»¬éå¸¸æ„Ÿè°¢ Apollo çš„æœ‹å‹ä»¬çš„å·¥ä½œï¼Œä»–ä»¬ä¸æ–­è‡´åŠ›äºæ”¹è¿›å›´ç»• SDL å¼€å‘çš„å¼€å‘å·¥ä½œæµç¨‹ã€‚

å¦ä¸€ä¸ªä»¥ SDL ä¼˜å…ˆæ„å»º GraphQL æœåŠ¡å™¨çš„æµè¡Œç¤ºä¾‹æ˜¯[AWS AppSync](https://aws-amplify.github.io/docs/js/api#updating-your-graphql-schema)ã€‚å®ƒä¸ Apollo æ¨¡å‹ç•¥æœ‰ä¸åŒï¼Œå› ä¸ºè§£æå™¨ï¼ˆé€šå¸¸ï¼‰ä¸æ˜¯ä»¥ç¼–ç¨‹æ–¹å¼å®ç°ï¼Œè€Œæ˜¯ä»æ¨¡å¼å®šä¹‰è‡ªåŠ¨ç”Ÿæˆã€‚

è™½ç„¶ç¤¾åŒºä»è¿™ä¹ˆå¤šå·¥å…·ä¸­è·ç›ŠåŒªæµ…ï¼Œä½†æ˜¯å½“å¼€å‘äººå‘˜éœ€è¦å¯¹æŸä¸ªç»„ç»‡çš„å·¥å…·é“¾è¿›è¡Œå…¨é¢èµŒæ³¨æ—¶ï¼Œå­˜åœ¨ç”Ÿæ€ç³»ç»Ÿé”å®šçš„é£é™©ã€‚

#### SDL é¦–å…ˆå¿½ç•¥äº†ç¼–ç¨‹è¯­è¨€çš„å„ä¸ªç‰¹å¾

SDL ä¼˜å…ˆçš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ— è®ºä½¿ç”¨å“ªç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒéƒ½ä¼šé€šè¿‡å¼ºåŠ ç±»ä¼¼çš„åŸåˆ™æ¥å¿½ç•¥ç¼–ç¨‹è¯­è¨€çš„å„ä¸ªç‰¹å¾ã€‚

ä»£ç ä¼˜å…ˆæ–¹æ³•åœ¨å…¶ä»–è¯­è¨€ä¸­è¿è¡Œå¾—éå¸¸å¥½ï¼šScala åº“[`sangria-graphql`](https://github.com/sangria-graphql/sangria)åˆ©ç”¨ Scala å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿæ¥ä¼˜é›…åœ°æ„å»º GraphQL æ¨¡å¼ï¼Œ[`graphlq-ruby`](https://github.com/rmosolgo/graphql-ruby)ä½¿ç”¨ Ruby è¯­è¨€çš„è®¸å¤šä»¤äººæ•¬ç•çš„ DSL åŠŸèƒ½ã€‚

---

### ä»£ç ä¼˜å…ˆï¼šGraphQL æœåŠ¡å™¨å¼€å‘çš„ä¸€ç§è¯­è¨€æƒ¯ç”¨æ–¹å¼

#### æ‚¨éœ€è¦çš„å”¯ä¸€å·¥å…·æ˜¯æ‚¨çš„ç¼–ç¨‹è¯­è¨€

å¤§å¤šæ•° SDL ä¼˜å…ˆé—®é¢˜æ¥è‡ªäºæˆ‘ä»¬éœ€è¦*å°†æ‰‹åŠ¨ç¼–å†™çš„ SDL æ¨¡å¼æ˜ å°„åˆ°ç¼–ç¨‹è¯­è¨€*ã€‚æ­¤æ˜ å°„æ˜¯å¯¼è‡´éœ€è¦å…¶ä»–å·¥å…·çš„åŸå› ã€‚å¦‚æœæˆ‘ä»¬éµå¾ª SDL ä¼˜å…ˆè·¯å¾„ï¼Œåˆ™éœ€è¦ä¸º*æ¯ä¸ª*è¯­è¨€ç”Ÿæ€ç³»ç»Ÿé‡æ–°åˆ›å»ºæ‰€éœ€çš„å·¥å…·ï¼Œå¹¶ä¸”*æ¯ä¸ª*è¯­è¨€ç”Ÿæ€ç³»ç»Ÿçš„*å¤–è§‚*ä¹Ÿä¸åŒã€‚

æˆ‘ä»¬åº”è¯¥åŠªåŠ›å¯»æ±‚ä¸€ç§æ›´ç®€å•çš„å¼€å‘æ¨¡å‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ›´å¤šå·¥å…·æ¥å¢åŠ  GraphQL æœåŠ¡å™¨å¼€å‘çš„å¤æ‚æ€§ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå®ƒå…è®¸å¼€å‘äººå‘˜åˆ©ç”¨ä»–ä»¬å·²ç»ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ - è¿™å°±æ˜¯*ä»£ç ä¼˜å…ˆ*çš„æƒ³æ³•ã€‚

#### ä»€ä¹ˆæ˜¯ä»£ç ä¼˜å…ˆï¼Ÿ

è¿˜è®°å¾—å®šä¹‰æ¶æ„çš„æœ€åˆç¤ºä¾‹`graphql-js`å—ï¼Ÿè¿™æ˜¯ä»£ç ä¼˜å…ˆæ„å‘³ç€çš„*æœ¬è´¨*ã€‚æ²¡æœ‰æ‰‹åŠ¨ç»´æŠ¤çš„æ¨¡å¼å®šä¹‰ç‰ˆæœ¬ï¼Œè€Œæ˜¯ä»å®ç°æ¨¡å¼çš„ä»£ç *ç”Ÿæˆ* SDL ã€‚

è™½ç„¶ `graphql-js`API éå¸¸å†—é•¿ï¼Œä½†æ˜¯å…¶ä»–è¯­è¨€ä¸­æœ‰è®¸å¤šæµè¡Œçš„æ¡†æ¶åŸºäºä»£ç ä¼˜å…ˆæ–¹æ³•å·¥ä½œï¼Œä¾‹å¦‚å·²ç»æåˆ°çš„ï¼Œä»¥åŠ Python æˆ– Elixirã€‚[`graphlq-ruby`](https://github.com/rmosolgo/graphql-ruby) [`sangria-graphql`](https://github.com/sangria-graphql/sangria)[`graphene`](https://github.com/graphql-python/graphene)[`absinthe-graphql`](https://github.com/absinthe-graphql/absinthe)

![image-20190308141926516](/static/assets/image-20190308141926516.jpg)

#### ä»£ç ä¼˜å…ˆå®è·µ

è™½ç„¶æœ¬æ–‡ä¸»è¦æ˜¯å…³äºé¦–å…ˆç†è§£ SDL çš„é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºæ„å»ºå…·æœ‰ä»£ç ä¼˜å…ˆæ¡†æ¶çš„ GraphQL æ¶æ„çš„å†…å®¹æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå°å°çš„ç‰‡æ®µï¼š

Hello World

```javascript
const Query = objectType('Query', t => {
  t.string('hello', {
    args: { name: stringArg() },
    resolve: (_, { name }) => `Hello ${name || `World`}!`,
  })
})

const schema = makeSchema({
  types: [Query],
  outputs: {
    schema: './schema.graphql'),
    typegen: './typegen.ts',
  },
})
```

User Example

```javascript
const User = objectType('User', t => {
  t.id('id')
  t.string('name', { nullable: true })
})

const Query = objectType('Query', t => {
  t.field('user', 'User', {
    args: { id: idArg() },
    resolve: (_, { id }) => fetchUserById(id) // fetch the user, e.g. from a database
  })
})

const Mutation = objectType('Query', t => {
  t.field('createUser', 'User', {
    args: { name: stringArg() },
    resolve: (_, { name }) => createUser(name) // create a user, e.g. in a database
  })
})

const schema = makeSchema({
  types: [User, Query, Mutation],
  outputs: {
    schema: './schema.graphql'),
    typegen: './typegen.ts',
  },
})
```

é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨ TypeScript / JavaScript ä¸­å®šä¹‰ GraphQL ç±»å‹ã€‚é€šè¿‡æ­£ç¡®çš„è®¾ç½®å¹¶ä¸”ç”±äº[æ™ºèƒ½ä»£ç è¡¥å…¨](https://en.wikipedia.org/wiki/Intelligent_code_completion)ï¼Œæ‚¨çš„ç¼–è¾‘äººå‘˜å°†èƒ½å¤Ÿåœ¨æ‚¨å®šä¹‰æ—¶å»ºè®®å¯ç”¨çš„ GraphQL ç±»å‹ï¼Œå­—æ®µå’Œå‚æ•°ã€‚

å…¸å‹çš„ç¼–è¾‘å™¨å·¥ä½œæµç¨‹åŒ…æ‹¬åœ¨åå°è¿è¡Œçš„å¼€å‘æœåŠ¡å™¨ï¼Œå¯åœ¨ä¿å­˜æ–‡ä»¶æ—¶é‡æ–°ç”Ÿæˆç±»å‹ã€‚

ä¸€æ—¦å®šä¹‰äº†æ‰€æœ‰ GraphQL ç±»å‹ï¼Œå°±ä¼šå°†å®ƒä»¬ä¼ é€’ç»™å‡½æ•°ä»¥åˆ›å»º[`GraphQLSchema`](https://graphql.org/graphql-js/type/#graphqlschema)å¯åœ¨ GraphQL æœåŠ¡å™¨ä¸­ä½¿ç”¨çš„å®ä¾‹ã€‚é€šè¿‡æŒ‡å®š`ouputs`ï¼Œæ‚¨å¯ä»¥å®šä¹‰ç”Ÿæˆçš„ SDL å’Œæ‰“å­—æ‰€åœ¨çš„ä½ç½®ã€‚

æœ¬ç³»åˆ—æ–‡ç« çš„ä¸‹ä¸€éƒ¨åˆ†å°†æ›´è¯¦ç»†åœ°è®¨è®ºä»£ç ä¼˜å…ˆå¼€å‘ã€‚

#### é¦–å…ˆè·å¾— SDL çš„å¥½å¤„ï¼Œè€Œæ— éœ€ä½¿ç”¨æ‰€æœ‰å·¥å…·

ä¹‹å‰æˆ‘ä»¬åˆ—ä¸¾äº† SDL ä¼˜å…ˆå¼€å‘çš„å¥½å¤„ã€‚äº‹å®ä¸Šï¼Œåœ¨ä½¿ç”¨ä»£ç ä¼˜å…ˆæ–¹æ³•æ—¶ï¼Œæ²¡æœ‰å¿…è¦åœ¨å¤§å¤šæ•°æ–¹é¢å¦¥åã€‚

â€‹**ä½¿ç”¨ GraphQL æ¶æ„ä½œä¸ºå‰ç«¯å’Œåç«¯å›¢é˜Ÿçš„å…³é”®é€šä¿¡å·¥å…·çš„æœ€é‡è¦çš„å¥½å¤„ä»ç„¶å­˜åœ¨ã€‚**

ä»¥ GitHub GraphQL API ä¸ºä¾‹ï¼šGitHub ä½¿ç”¨ Ruby å’Œä»£ç ä¼˜å…ˆçš„æ–¹æ³•æ¥å®ç°ä»–ä»¬çš„ APIã€‚SDL æ¶æ„å®šä¹‰æ˜¯åŸºäºå®ç° API çš„ä»£ç ç”Ÿæˆçš„ã€‚ä½†æ˜¯ï¼Œæ¶æ„å®šä¹‰ä»ä¼šæ¥å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚è¿™ä½¿å¾—åœ¨å¼€å‘è¿‡ç¨‹ä¸­è·Ÿè¸ª API çš„æ›´æ”¹éå¸¸å®¹æ˜“ï¼Œå¹¶ä¸”å¯ä»¥æ”¹å–„å„ä¸ªå›¢é˜Ÿä¹‹é—´çš„é€šä¿¡ã€‚

API æ–‡æ¡£æˆ–æˆæƒå‰ç«¯å¼€å‘äººå‘˜ç­‰å…¶ä»–å¥½å¤„ä¹Ÿä¸ä¼šå› ä»£ç ä¼˜å…ˆæ–¹æ³•è€Œä¸¢å¤±ã€‚

### ä»£ç ä¼˜å…ˆçš„æ¡†æ¶ï¼Œå¾ˆå¿«å°±ä¼šè¿›å…¥ä½ çš„ IDE

è¿™ç¯‡æ–‡ç« ç›¸å½“ç†è®ºåŒ–ï¼Œå¹¶æ²¡æœ‰åŒ…å«å¤ªå¤šä»£ç  - æˆ‘ä»¬ä»ç„¶å¸Œæœ›èƒ½å¼•èµ·æ‚¨å¯¹ä»£ç ä¼˜å…ˆå¼€å‘çš„å…´è¶£ã€‚è¦æŸ¥çœ‹æ›´å¤šå®é™…ç¤ºä¾‹å¹¶äº†è§£æœ‰å…³ä»£ç ä¼˜å…ˆå¼€å‘ä½“éªŒçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç»§ç»­å…³æ³¨å¹¶åœ¨æ¥ä¸‹æ¥çš„å‡ å¤©å†…å…³æ³¨[Prisma Twitter å¸æˆ·](https://www.twitter.com/prisma) ğŸ‘€

> ä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æ€ä¹ˆæ ·ï¼ŸåŠ å…¥**[Prisma Wechat Group](/wechat)**ï¼Œä¸å…¶ä»– GraphQL çˆ±å¥½è€…ä¸€èµ·è®¨è®º SDL ä¼˜å…ˆå’Œä»£ç ä¼˜å…ˆå¼€å‘ã€‚
