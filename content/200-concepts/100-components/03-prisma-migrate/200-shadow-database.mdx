---
title: å½±å­æ•°æ®åº“
---

<TopBlock>

<Admonition type="warning">

**æœªæ”¯æŒ MongoDB** <br />
Prisma Migrate ç›®å‰ä¸æ”¯æŒ[MongoDB è¿æ¥](../../database-connectors/mongodb)ã€‚

</Admonition>

Prisma Migrate åœ¨è¿è¡Œä»¥å¼€å‘ä¸ºä¸­å¿ƒçš„å‘½ä»¤æ—¶ä¼šä½¿ç”¨ç¬¬äºŒä¸ªä¸´æ—¶æ•°æ®åº“ï¼Œä¾‹å¦‚:

- `prisma migrate dev`
- `prisma migrate reset`

å½±å­æ•°æ®åº“ä¼šåœ¨æ¯æ¬¡è¿è¡Œå¼€å‘å‘½ä»¤æ—¶**è‡ªåŠ¨åˆ›å»º**å’Œ**åˆ é™¤**ï¼Œä¸»è¦ç”¨äº**æ£€æµ‹é—®é¢˜**ï¼Œå¦‚æ¶æ„æ¼‚ç§»ã€‚

<FootNote>

\* å¦‚æœæ‚¨ä½¿ç”¨äº‘æ‰˜ç®¡æ•°æ®åº“è¿›è¡Œå¼€å‘ï¼Œåˆ™éœ€è¦[æ‰‹åŠ¨åˆ›å»ºå½±å­æ•°æ®åº“](#cloud-hosted-shadow-databases-must-be-created-manually)ã€‚

</FootNote>

> **é‡è¦çš„**: å½±å­æ•°æ®åº“åœ¨ç”Ÿäº§ä¸­æ˜¯**ä¸éœ€è¦**çš„ï¼Œå¹¶ä¸”ä¸ä¼šè¢«`prisma migrate resolve`å’Œ`prisma migrate deploy`ç­‰ä»¥ç”Ÿäº§ä¸ºä¸­å¿ƒçš„å‘½ä»¤ä½¿ç”¨ã€‚

</TopBlock>

## å½±å­æ•°æ®åº“çš„å·¥ä½œåŸç†

è¿è¡Œ`prisma migrate dev`åˆ›å»ºæ–°è¿ç§»æ—¶ï¼ŒPrisma Migrate ä¼šä½¿ç”¨å½±å­æ•°æ®åº“:

- [æ£€æµ‹æ¶æ„æ¼‚ç§»](#detecting-schema-drift)ï¼Œè¿™æ„å‘³ç€æ£€æŸ¥å¼€å‘æ•°æ®åº“æ²¡æœ‰**æ‰‹åŠ¨æ›´æ”¹**ã€‚
- [ç”Ÿæˆæ–°è¿ç§»](#generating-new-migrations)

<details><summary>ğŸ¨ å±•å¼€æŸ¥çœ‹ä»¥å¡é€šå½¢å¼è§£é‡Šçš„å½±å­æ•°æ®åº“ã€‚

</summary>

![ä¸€å¹…å¡é€šç”»ï¼Œå±•ç¤ºäº†å½±å­æ•°æ®åº“çš„å·¥ä½œåŸç†ã€‚](shadow-database.png)

</details>

### æ£€æµ‹æ¶æ„æ¼‚ç§»

ä¸ºäº†æ£€æµ‹å¼€å‘ä¸­çš„æ¼‚ç§»ï¼ŒPrisma Migrate:

1. åˆ›å»ºå½±å­æ•°æ®åº“çš„æœ€æ–°å‰¯æœ¬ (å¦‚æœå½±å­æ•°æ®åº“æ˜¯äº‘æ‰˜ç®¡çš„ï¼Œåˆ™æ‰§è¡Œè½¯é‡ç½®)ã€‚
1. åœ¨å½±å­æ•°æ®åº“ä¸­é‡æ”¾**å½“å‰**è¿ç§»å†å²è®°å½•ã€‚
1. **æ£€æŸ¥**å½±å­æ•°æ®åº“ï¼Œä»¥ç”Ÿæˆ Prisma æ¶æ„çš„'å½“å‰çŠ¶æ€'ã€‚
1. å°†å½“å‰è¿ç§»å†å²çš„æœ€ç»ˆçŠ¶æ€ä¸å¼€å‘æ•°æ®åº“è¿›è¡Œæ¯”è¾ƒã€‚
1. å¦‚æœå½“å‰è¿ç§»å†å²çš„ç»“æŸçŠ¶æ€ä¸å¼€å‘æ•°æ®åº“ä¸åŒ¹é… (ä¾‹å¦‚ï¼Œç”±äºæ‰‹åŠ¨æ›´æ”¹)ï¼Œåˆ™æŠ¥å‘Š**æ¶æ„æ¼‚ç§»**ã€‚

å¦‚æœ Prisma Migrate æ²¡æœ‰æ£€æµ‹åˆ°æ¶æ„æ¼‚ç§»ï¼Œå®ƒå°†ç»§ç»­[ç”Ÿæˆæ–°çš„è¿ç§»](#generating-new-migrations)ã€‚

> **è¯·æ³¨æ„**: å½±å­æ•°æ®åº“ä¸è´Ÿè´£æ£€æŸ¥è¿ç§»æ–‡ä»¶æ˜¯å¦å·²**ç¼–è¾‘æˆ–åˆ é™¤**ã€‚è¿™æ˜¯ä½¿ç”¨äº†`_prisma_Migrations`è¡¨ä¸­çš„`checksum`å­—æ®µå®Œæˆçš„ã€‚

åœ¨[2.25.0](https://github.com/prisma/prisma/releases/tag/2.25.0)å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒPrisma Migrate ä¼šè¾“å‡ºå…³äºæ•°æ®åº“é‡Œå“ªäº›éƒ¨åˆ†å‘ç”Ÿäº†æ¼‚ç§»çš„è¯¦ç»†ä¿¡æ¯ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹è¾“å‡ºä¸­ï¼Œä»ç›®æ ‡æ•°æ®åº“ç”Ÿæˆçš„æ¶æ„ä¼šä¸é¢„æœŸçš„æ¶æ„ä¸åŒã€‚ ä¾‹å¦‚ï¼Œç›®æ ‡æ•°æ®åº“ä¸­çš„ `Color` æšä¸¾ç¼ºå°‘é¢„æœŸçš„å˜é‡ `RED`ï¼Œå´åŒ…å«ç€æ„å¤–çš„å˜é‡ `TRANSPARENT` :

```
[*] Changed the `Color` enum
  [+] Added variant `TRANSPARENT`
  [-] Removed variant `RED`

[*] Changed the `Cat` table
  [-] Removed column `color`
  [+] Added column `vaccinated`

[*] Changed the `Dog` table
  [-] Dropped the primary key on columns (id)
  [-] Removed column `name`
  [+] Added column `weight`
  [*] Altered column `isGoodDog` (arity changed from Nullable to Required, default changed from `None` to `Some(Value(Boolean(true)))`)
  [+] Added unique index on columns (weight)
```

### ç”Ÿæˆæ–°è¿ç§»

å‡è®¾ Prisma Migrate æ²¡æœ‰[æ£€æµ‹æ¶æ„æ¼‚ç§»](#detecting-schema-drift)ï¼Œå®ƒä¼šæ¥ç€ä»æ¶æ„æ›´æ”¹ä¸­ç”Ÿæˆæ–°è¿ç§»ã€‚è¦ç”Ÿæˆæ–°çš„è¿ç§»ï¼Œè¯·ä½¿ç”¨ Prisma Migrateit:

1. æ ¹æ®å½“å‰ Prisma æ¶æ„è®¡ç®—ç›®æ ‡æ•°æ®åº“æ¶æ„ã€‚
1. æ¯”è¾ƒç°æœ‰è¿ç§»å†å²è®°å½•å’Œç›®æ ‡æ¶æ„çš„ç»“æŸçŠ¶æ€ï¼Œå¹¶ç”Ÿæˆä»ä¸€ä¸ªè¿ç§»åˆ°å¦ä¸€ä¸ªè¿ç§»çš„æ­¥éª¤ã€‚
1. å°†è¿™äº›æ­¥éª¤å‘ˆç°ä¸º SQL å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨æ–°çš„è¿ç§»æ–‡ä»¶ä¸­ã€‚
1. å°†ç”Ÿæˆçš„è¿ç§»åº”ç”¨åˆ°å¼€å‘æ•°æ®åº“ (å‡è®¾æ‚¨æ²¡æœ‰æŒ‡å®š `--create-only` æ ‡å¿—)
1. åˆ é™¤å½±å­æ•°æ®åº“(äº‘æ‰˜ç®¡æ•°æ®åº“ä¸èƒ½åˆ é™¤ï¼Œä½†ä¼šåœ¨ `migrate dev` å‘½ä»¤å¼€å§‹æ—¶é‡ç½®)

## äº‘æ‰˜ç®¡çš„å½±å­æ•°æ®åº“å¿…é¡»æ‰‹åŠ¨åˆ›å»º

ä¸€äº›äº‘æä¾›å•†ä¸å…è®¸æ‚¨ä½¿ç”¨ SQL å¯¹æ•°æ®åº“è¿›è¡Œåˆ é™¤æˆ–åˆ›å»ºã€‚æœ‰äº›åˆ™éœ€è¦é€šè¿‡åœ¨çº¿ç•Œé¢æ‰èƒ½å¯¹æ•°æ®åº“è¿›è¡Œåˆ›å»ºæˆ–åˆ é™¤ï¼Œè€Œæœ‰äº›åˆ™é™åˆ¶æ‚¨åªèƒ½åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ã€‚å¦‚æœæ‚¨åœ¨è¿™æ ·çš„äº‘æ‰˜ç®¡ç¯å¢ƒä¸­è¿›è¡Œ**å¼€å‘**ï¼Œå¿…é¡»:

1. åˆ›å»ºä¸“ç”¨çš„äº‘æ‰˜ç®¡å½±å­æ•°æ®åº“
2. å°† URL æ·»åŠ åˆ°[`shadowDatabaseUrl`](../../../reference/api-reference/prisma-schema-reference#datasource) <span class="api"></span> å­—æ®µ:

```prisma highlight=4;normal
datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}
```

## å½±å­æ•°æ®åº“ç”¨æˆ·æƒé™

ä¸ºäº†åœ¨ä½¿ç”¨è¯¸å¦‚ `migrate dev` å’Œ `migrate reset` ç­‰å¼€å‘å‘½ä»¤æ¥åˆ›å»ºå’Œåˆ é™¤å½±å­æ•°æ®åº“ï¼ŒPrisma Migrate ç›®å‰è¦æ±‚æ‚¨çš„ `datasource` ä¸­å®šä¹‰çš„æ•°æ®åº“ç”¨æˆ·å¿…é¡»å…·æœ‰**åˆ›å»ºæ•°æ®åº“**çš„æƒé™ã€‚

| æ•°æ®åº“     | æ•°æ®åº“ç”¨æˆ·éœ€æ±‚                                                                                                                                                                         |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SQLite     | æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ã€‚                                                                                                                                                                         |
| MySQL      | æ•°æ®åº“ç”¨æˆ·å¿…é¡»å…·æœ‰ `CREATE, ALTER, DROP, REFERENCES ON *.*` æƒé™ã€‚                                                                                                                     |
| PostgreSQL | ç”¨æˆ·å¿…é¡»æ˜¯è¶…çº§ç”¨æˆ·æˆ–å…·æœ‰ `CREATEDB` æƒé™ã€‚è¯·å‚è§ `CREATE ROLE` ([PostgreSQL å®˜æ–¹æ–‡æ¡£](https://www.postgresql.org/docs/12/sql-createdatabase.html))ã€‚                                   |
| SQL Server | ç”¨æˆ·å¿…é¡»æ˜¯ç«™ç‚¹ç®¡ç†å‘˜æˆ–å…·æœ‰ `SERVER` å®‰å…¨æƒé™ã€‚è¯·å‚è§[å®˜æ–¹æ–‡æ¡£](https://docs.microsoft.com/en-us/sql/relational-databases/security/permissions-database-engine?view=sql-server-ver15)ã€‚ |

> å¦‚æœæ‚¨ä½¿ç”¨äº‘æ‰˜ç®¡æ•°æ®åº“è¿›è¡Œå¼€å‘ï¼Œä¸”æ— æ³•ä½¿ç”¨è¿™äº›æƒé™ï¼Œè¯·å‚é˜…ï¼š[äº‘æ‰˜ç®¡å½±å­æ•°æ®åº“](#cloud-hosted-shadow-databases-must-be-created-manually)

å¦‚æœ Prisma Migrate æ— æ³•ä½¿ç”¨æ‚¨æä¾›çš„è¿æ¥ URL åˆ›å»ºå½±å­æ•°æ®åº“ï¼Œåˆ™ä¼šå¼•å‘ä»¥ä¸‹é”™è¯¯:

```
Error: A migration failed when applied to the shadow database
Database error: Error querying the database: db error: ERROR: permission denied to create database
```

è¦è§£å†³æ­¤é”™è¯¯ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

- å¦‚æœæ‚¨åœ¨æœ¬åœ°å·¥ä½œï¼Œå»ºè®®æ‚¨æ›´æ”¹æ•°æ®åº“ç”¨æˆ·çš„æƒé™ã€‚
- å¦‚æœæ‚¨æ­£åœ¨åŸºäºäº‘æ•°æ®åº“è¿›è¡Œå¼€å‘ (ä¾‹å¦‚ï¼Œåœ¨ Heroku ä¸Š)ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨æš‚æ—¶åˆ‡æ¢åˆ°æœ¬åœ° Web ç¯å¢ƒ(ä¾‹å¦‚åœ¨ Docker ä¸Šè¿è¡Œæ‚¨çš„å¼€å‘æ•°æ®åº“)ï¼Œå¹¶å…³æ³¨[GitHub issue #4571](https://github.com/prisma/prisma/issues/4571)ä¸Šçš„è®¨è®ºã€‚
- å¦‚æœæ‚¨æ­£åœ¨åŸºäºäº‘æ•°æ®åº“è¿›è¡Œå¼€å‘ (ä¾‹å¦‚ï¼Œåœ¨ Heroku ä¸Š)ï¼Œå¹¶ä¸”**æ— æ³•åˆ‡æ¢**ï¼Œè¯·ç»§ç»­å…³æ³¨ 2.12.0 ç‰ˆæœ¬ï¼Œå¹¶å…³æ³¨[GitHub issue #4571](https://github.com/prisma/prisma/issues/4571)ä¸Šçš„è®¨è®ºã€‚
- å¦‚æœæ‚¨æ­£åœ¨åŸºäºäº‘æ•°æ®åº“è¿›è¡Œå¼€å‘ (ä¾‹å¦‚ï¼Œåœ¨ Heroku ä¸Š)ï¼Œå¹¶ä¸”æ­£åœ¨è¿›è¡Œ**åŸå‹å¼€å‘**ï¼Œå› æ­¤æ‚¨ä¸å¿…å…³å¿ƒç”Ÿæˆçš„è¿ç§»æ–‡ä»¶ï¼Œè€Œåªéœ€è¦å°† Prisma æ•°æ®æ¨¡å‹åº”ç”¨åˆ°æ•°æ®åº“æ¶æ„ï¼Œæ‚¨å¯ä»¥è¿è¡Œ[`prisma db push`](../../../reference/api-reference/command-reference#db)è€Œä¸æ˜¯`prisma migrate dev`å‘½ä»¤ã€‚

> **é‡è¦çš„**: åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå½±å­æ•°æ®åº“æ˜¯å¿…ä¸å¯å°‘çš„ (ç‰¹åˆ«æ˜¯å¯¹äº` prisma migrate dev` å‘½ä»¤) â€”â€” æ‚¨ä¸éœ€è¦å¯¹ç”Ÿäº§ç¯å¢ƒè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚
